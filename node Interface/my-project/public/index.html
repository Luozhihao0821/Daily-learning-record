<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生管理系统</title>
</head>

<body>
    <h1>学生列表</h1>
    <table>
        <thead>
            <tr>
                <th>学生姓名</th>
                <th>学生年龄</th>
                <th>学生性别</th>
                <th>学生操作</th>
            </tr>
        </thead>
        <tbody class="tbody">

        </tbody>
    </table>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        getStudents();
        function getStudents() {
            $.ajax({
                url: '/students/getStudents',
                type: 'get',
                success({ message, status, data }) {
                    if (status) {
                        // 渲染数据

                        // 方式三：
                        const str=data.map(function (item,index) {
                            return `<tr>
                                    <td>${item.name}</td>
                                    <td>${item.age}</td>
                                    <td>${item.gender}</td>
                                    <td>
                                        <button class="">修改</button>
                                        <button class="removeBtn" data-id='${item._id}'>删除</button>
                                    </td>
                                </tr>`
                        }).join('')
                        $('tbody').html(str)

                        // 方式二:只需要添加一次
                        // let str = ''
                        // data.forEach(item => {
                        //     str += `<tr>
                        //             <td>${item.name}</td>
                        //             <td>${item.age}</td>
                        //             <td>${item.gender}</td>
                        //             <td>
                        //                 <button>修改</button>
                        //                 <button>删除</button>
                        //             </td>
                        //         </tr>`;
                        // });
                        // $('tbody').append(str)


                        // 方式一
                        // data.forEach(item => {
                        //     $('tbody').append(`
                        //         <tr>
                        //             <td>${item.name}</td>
                        //             <td>${item.age}</td>
                        //             <td>${item.gender}</td>
                        //             <td>
                        //                 <button>修改</button>
                        //                 <button>删除</button>
                        //             </td>
                        //         </tr>
                        //     `)
                        // });
                    }
                }
            })
        }

        $('.tbody').on('click','.removeBtn',function(e){
            // 拿到对应对象的id
            let _id=$(this).data('id');
            $.ajax({
                url: '/students/deleteStudent',
                type: 'post',
                data:{_id},
                success(msg) {
                    if (msg.status) {
                        alert("删除成功！");
                        getStudents();
                    }
                }
            })
        })
    </script>
</body>

</html>